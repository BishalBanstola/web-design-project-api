<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auth0 Example</title>
  </head>
  <body>
    <h1>Auth0 Example</h1>
    <button id="login">Log In</button>
    <button id="logout">Log Out</button>
    <div id="profile"></div>

    <script src="https://cdn.auth0.com/js/auth0-spa-js/1.21.1/auth0-spa-js.production.js"></script>
    <script>
      async function initAuth0() {
        const auth0 = await createAuth0Client({
          domain: "dev-xvv0pvrqkgxsikp3.us.auth0.com",
          client_id: "Dj9BctQtEdC47bvIrMVQJc2H0kypuc6X",
          redirect_uri: window.location.origin,
        });

        const isAuthenticated = await auth0.isAuthenticated();

        if (!isAuthenticated) {
          const query = window.location.search;
          if (query.includes("code=") && query.includes("state=")) {
            await auth0.handleRedirectCallback();
            window.history.replaceState({}, document.title, "/");
          }
        }

        const loginButton = document.getElementById("login");
        loginButton.addEventListener("click", async () => {
          await auth0.loginWithRedirect();
        });

        const logoutButton = document.getElementById("logout");
        logoutButton.addEventListener("click", async () => {
          await auth0.logout({
            returnTo: window.location.origin,
          });
        });

        const profileElement = document.getElementById("profile");
        const updateProfile = async () => {
          const user = await auth0.getUser();
          profileElement.innerText = JSON.stringify(user, null, 2);
        };

        if (isAuthenticated) {
          profileElement.style.display = "block";
          updateProfile();
        } else {
          profileElement.style.display = "none";
        }
      }

      initAuth0();
    </script>
  </body>
</html>
